<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Relife — Trang chủ</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
  <link href="CSS/index.css" rel="stylesheet">
</head>
<body>

<nav class="navbar bg-white shadow-sm py-2">
  <div class="container d-flex align-items-center justify-content-between position-relative">
    <div class="fw-bold" style="font-size: 1.25rem;">Relife</div>

    <div class="search-box position-relative mx-2 w-100">
      <div class="search-row">
        <i class="bi bi-search small-muted ms-2"></i>
        <input id="searchInput" class="form-control form-control-sm border-0" placeholder="Tìm: bài, người, hashtag..." aria-label="search">
      </div>
      <div id="searchResults" class="search-results"></div>
    </div>

    <button class="btn btn-light btn-sm" data-bs-toggle="offcanvas" data-bs-target="#menuCanvas">
      <i class="bi bi-list fs-4"></i>
    </button>
  </div>
</nav>

<!-- Offcanvas Menu -->
<!-- Offcanvas Menu -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="menuCanvas">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">
      <i class="bi bi-list me-2"></i>Menu
    </h5>
    <button class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <!-- Auth Area -->
    <div id="menuAuthArea" class="mb-3"></div>

    <hr>

    <!-- Navigation Links (Grid Layout) -->
    <div class="menu-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 320px; overflow-y: auto; padding: 4px; margin-bottom: 1rem;">
      <a href="tag.html" class="menu-grid-item" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; text-decoration: none; color: #1d1d1f; min-height: 100px; text-align: center;">
        <i class="bi bi-hash" style="font-size: 1.75rem;"></i>
        <span style="font-size: 0.875rem; font-weight: 600;">Hashtag Topic</span>
      </a>

      <a id="myProfileMenuLink" href="profile.html" class="menu-grid-item" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; text-decoration: none; color: #1d1d1f; min-height: 100px; text-align: center;">
        <i class="bi bi-person" style="font-size: 1.75rem;"></i>
        <span style="font-size: 0.875rem; font-weight: 600;">Profile cá nhân</span>
      </a>
      
      <a href="notification.html" class="menu-grid-item" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; text-decoration: none; color: #1d1d1f; min-height: 100px; text-align: center;">
        <i class="bi bi-bell" style="font-size: 1.75rem;"></i>
        <span style="font-size: 0.875rem; font-weight: 600;">Notifications</span>
      </a>
      
      <a href="./other/beta/index.html" class="menu-grid-item" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; text-decoration: none; color: #1d1d1f; min-height: 100px; text-align: center;">
        <i class="bi bi-pc-display" style="font-size: 1.75rem;"></i>
        <span style="font-size: 0.875rem; font-weight: 600; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">Relife 4.1 Beta</span>
      </a>

      <button id="btnOpenNewPost" class="menu-grid-item btn-primary" data-bs-toggle="modal" data-bs-target="#newPostModal" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 16px 12px; background: linear-gradient(135deg, #0d6efd, #5856D6); color: white; border: none; border-radius: 12px; min-height: 100px; text-align: center; cursor: pointer;">
        <i class="bi bi-plus-lg" style="font-size: 1.75rem; color: white;"></i>
        <span style="font-size: 0.875rem; font-weight: 600; color: white;">Đăng bài mới</span>
      </button>
    </div>

    <hr>

    <!-- Version Info -->
    <div class="text-center">
      <small class="text-muted d-block mb-2">
        <i class="bi bi-info-circle me-1"></i>Phiên bản
      </small>
      <div class="mb-1">
        <span class="badge-trial">Relife 4.0</span>
      </div>
      <div>
        <span class="badge bg-secondary">relife_0.4.0.101225</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Feed Container -->
<div class="container my-3">
  <div id="feed" class="d-grid gap-3"></div>
  
  <!-- Loading Indicator -->
  <div id="loadingIndicator">
    <div class="spinner"></div>
    <div class="small-muted">Đang tải thêm bài viết...</div>
  </div>
</div>

<!-- New Post Modal -->
<div class="modal fade" id="newPostModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <form id="newPostForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-pencil-square me-2"></i>Viết bài mới
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- User Info -->
        <div id="newPostUserInfo" class="mb-3"></div>
        
        <!-- Title -->
        <div class="mb-3">
          <input id="postTitle" class="form-control" placeholder="Tiêu đề bài viết" required>
        </div>
        
        <!-- Quill Editor -->
        <div id="editor" class="mb-3"></div>
        
        <!-- Hashtags -->
        <div class="mb-3">
          <input id="postHashtags" class="form-control" placeholder="#hashtag #khác">
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            Nhập link ảnh/video/iframe vào nội dung. Không hỗ trợ upload trực tiếp.
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-rounded" data-bs-dismiss="modal">
          <i class="bi bi-x-lg me-1"></i>Hủy
        </button>
        <button type="submit" class="btn btn-primary btn-rounded">
          <i class="bi bi-send-fill me-1"></i>Đăng bài
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Comments Modal (Synchronized from POST) -->
<div class="modal fade" id="commentsModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h6 id="commentsModalTitle">
          <i class="bi bi-chat-dots-fill me-2"></i>Bình luận
        </h6>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Comments List -->
        <div id="commentsList" class="mb-3"></div>
        
        <!-- Login Notice -->
        <div id="mustLoginToComment" class="alert alert-warning" style="display:none;">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Bạn cần <a href="#" id="openLoginFromComment">đăng nhập</a> để bình luận.
        </div>
        
        <!-- Comment Box Area -->
        <div id="commentBoxArea" style="display:none;">
          <!-- Reply Indicator -->
          <div id="replyIndicator" class="reply-indicator" style="display:none;">
            <i class="bi bi-reply-fill"></i>
            <span id="replyToName">Đang trả lời...</span>
            <button id="cancelReply" class="btn-cancel-reply" type="button">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          
          <!-- Commenter Info -->
          <div id="commenterInfo" class="mb-2"></div>
          
          <!-- Comment Textarea -->
          <textarea id="commentText" class="form-control mb-2" rows="3" 
                    placeholder="Viết bình luận... (Nhập @username để gắn tag)"></textarea>
          
          <!-- Post Comment Button -->
          <div class="d-flex justify-content-end">
            <button id="postCommentBtn" class="btn btn-primary btn-rounded">
              <i class="bi bi-send-fill me-1"></i>
              Gửi bình luận
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Report Modal -->
<div class="report-modal-overlay" id="reportOverlay"></div>
<div class="report-modal" id="reportModal">
  <h3><i class="bi bi-flag-fill me-2"></i>Báo cáo bình luận</h3>
  <div class="report-reason">
    <label>
      <input type="radio" name="reportReason" value="spam">
      <span>Spam hoặc quảng cáo</span>
    </label>
    <label>
      <input type="radio" name="reportReason" value="offensive">
      <span>Nội dung xúc phạm</span>
    </label>
    <label>
      <input type="radio" name="reportReason" value="inappropriate">
      <span>Không phù hợp</span>
    </label>
    <label>
      <input type="radio" name="reportReason" value="other" checked>
      <span>Lý do khác</span>
    </label>
  </div>
  <div class="report-buttons">
    <button class="btn-cancel" onclick="window.closeReportModal()">Hủy</button>
    <button class="btn-danger" onclick="window.submitReport()">Báo cáo</button>
  </div>
</div>

<!-- Mention Dropdown -->
<div class="mention-dropdown" id="mentionDropdown"></div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form id="registerForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-person-plus me-2"></i>Đăng ký
        </h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="regFullName" class="form-control mb-2" placeholder="Họ & tên thật" required>
        <input id="regDisplayName" class="form-control mb-2" placeholder="Tên hiển thị (công khai)" required>
        <input id="regTagName" class="form-control mb-2" placeholder='Tag Name Search (@username)' required>
        <select id="regGender" class="form-select mb-2">
          <option value="">Giới tính</option>
          <option value="female">Nữ</option>
          <option value="male">Nam</option>
          <option value="other">Khác</option>
        </select>
        <input id="regBirthday" type="date" class="form-control mb-2">
        <input id="regCountry" class="form-control mb-2" placeholder="Quốc gia">
        <input id="regEmail" type="email" class="form-control mb-2" placeholder="Email" required>
        <input id="regPassword" type="password" class="form-control mb-2" placeholder="Mật khẩu (≥6 ký tự)" required>
        <small class="text-muted">
          <i class="bi bi-info-circle me-1"></i>
          Admin sẽ gửi mã kích hoạt qua email sau 24 giờ.
        </small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-rounded" data-bs-dismiss="modal">Hủy</button>
        <button type="submit" class="btn btn-primary btn-rounded">Đăng ký</button>
      </div>
    </form>
  </div>
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form id="loginForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-box-arrow-in-right me-2"></i>Đăng nhập
        </h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="loginEmail" type="email" class="form-control mb-2" placeholder="Email" required>
        <input id="loginPassword" type="password" class="form-control mb-2" placeholder="Mật khẩu" required>
        <div id="activateBlock" style="display:none;">
          <hr>
          <div class="alert alert-info">
            <i class="bi bi-key-fill me-2"></i>
            Tài khoản chưa kích hoạt. Nhập mã kích hoạt do admin gửi:
          </div>
          <input id="activationCode" class="form-control mb-2" placeholder="Mã kích hoạt">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-rounded" data-bs-dismiss="modal">Hủy</button>
        <button type="submit" class="btn btn-primary btn-rounded">Đăng nhập</button>
      </div>
    </form>
  </div>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.min.js"></script>

<!-- Module script -->
<script type="module" src="JS/index.js"></script>

</body>
</html>
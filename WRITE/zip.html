<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>C√¥ng c·ª• n√©n vƒÉn b·∫£n theo System Key</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
.container {
    max-width: 800px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
}
textarea, input, select, button {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
}
textarea {
    height: 120px;
}
button {
    cursor: pointer;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
}
button:hover {
    background: #0056b3;
}
.row {
    display: flex;
    gap: 10px;
}
.row button {
    flex: 1;
}
</style>
</head>
<body>

<div class="container">
<h2>üîê C√¥ng c·ª• n√©n & gi·∫£i m√£ vƒÉn b·∫£n</h2>

<label>VƒÉn b·∫£n g·ªëc</label>
<textarea id="inputText"></textarea>

<label>System Key</label>
<input type="text" id="systemKey" placeholder="Nh·∫≠p System Key">

<label>C·∫•p ƒë·ªô n√©n</label>
<select id="level">
    <option value="1">Th·∫•p</option>
    <option value="2">Trung b√¨nh</option>
    <option value="3">N√©n cao</option>
    <option value="4">Si√™u n√©n</option>
</select>

<div class="row">
    <button onclick="encode()">M√£ h√≥a / N√©n</button>
    <button onclick="decode()">Gi·∫£i m√£</button>
</div>

<label>K·∫øt qu·∫£</label>
<textarea id="outputText"></textarea>
</div>

<script>
// ===== UTIL =====
function keySeed(key) {
    let seed = 0;
    for (let i = 0; i < key.length; i++) {
        seed += key.charCodeAt(i) * (i + 1);
    }
    return seed;
}

function shiftChar(c, shift) {
    const code = c.charCodeAt(0);
    if (code < 32 || code > 126) return c;
    return String.fromCharCode(((code - 32 + shift) % 95) + 32);
}

// ===== ENCODE =====
function encode() {
    let text = document.getElementById("inputText").value;
    let key = document.getElementById("systemKey").value;
    let level = parseInt(document.getElementById("level").value);

    if (!key) return alert("C·∫ßn nh·∫≠p System Key");

    let seed = keySeed(key);
    let result = "";

    // D·ªãch k√Ω t·ª±
    for (let i = 0; i < text.length; i++) {
        result += shiftChar(text[i], seed % 95);
    }

    if (level >= 2) {
        result = result.replace(/[aeiou]/gi, c => String.fromCharCode(c.charCodeAt(0) + 1));
    }

    if (level >= 3) {
        result = btoa(unescape(encodeURIComponent(result)));
    }

    if (level === 4) {
        result = result.replace(/=/g, "").replace(/[AEIOU]/g, "");
    }

    document.getElementById("outputText").value = result;
}

// ===== DECODE =====
function decode() {
    let text = document.getElementById("inputText").value;
    let key = document.getElementById("systemKey").value;
    let level = parseInt(document.getElementById("level").value);

    if (!key) return alert("C·∫ßn nh·∫≠p System Key");

    let seed = keySeed(key);
    let result = text;

    if (level === 4) {
        while (result.length % 4 !== 0) result += "=";
    }

    if (level >= 3) {
        try {
            result = decodeURIComponent(escape(atob(result)));
        } catch {
            return alert("Sai System Key ho·∫∑c d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá");
        }
    }

    if (level >= 2) {
        result = result.replace(/[bfjpv]/gi, c => String.fromCharCode(c.charCodeAt(0) - 1));
    }

    let finalText = "";
    for (let i = 0; i < result.length; i++) {
        finalText += shiftChar(result[i], 95 - (seed % 95));
    }

    document.getElementById("outputText").value = finalText;
}
</script>

</body>
</html>
